@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
    @Scripts.Render("~/bundles/jquery")
</head>
<body>
    <script type="text/javascript">
        function showErrorMessage(sCall, sType, sError, jqXHR) {
            //Temporary
            alert(sError);
        }

        function getNextSigningUrl(envelopeId) {
            $.when(
                getAsync(docuSignApiBaseUrl + "/api/envelopes/" + envelopeId + "/nextinplacesignurl?signInPlaceReturnUrl=" + signInPlaceReturnUrl)
            ).then(function (inplaceSignerResponse) {
                if (inplaceSignerResponse.SigningUrl) {
                    window.location.href = inplaceSignerResponse.SigningUrl;
                }
            });
        }

        function getAsync(resource) {
            var headers = new Headers();
            var options = {
                method: 'GET',
                mode: 'cors'
            };
            return fetch(resource, options)
                .then(this.handleErrors)
                .then((response) => response.json())
                .catch((error) => console.log(error.message));
        }

        function postAsync(resource, data) {
            var headers = new Headers();
            headers.set('Content-Type', 'application/json');
            var options = {
                method: 'POST',
                mode: 'cors',
                headers: headers,
                body: JSON.stringify(data)
            };
            return fetch(resource, options)
                .then((response) => response.json());
        }

        var docuSignApiBaseUrl = '@System.Configuration.ConfigurationManager.AppSettings["DocuSignApiBaseUrl"]';
        var signInPlaceReturnUrl = '@System.Configuration.ConfigurationManager.AppSettings["SignInPlaceReturnUrl"]';
        $(document).ready(function () {
            getNextSigningUrl('@ViewBag.EnvelopeId');
        });
    </script>
    <div>
        Event: <b>@ViewBag.Event</b><br />
        EnvelopeId: <b>@ViewBag.EnvelopeId</b>
    </div>
</body>
</html>
